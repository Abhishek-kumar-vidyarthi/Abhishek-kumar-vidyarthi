name: Auto Update Profile (Professional)

on:
  schedule:
    - cron: "0 5 * * *"   # Runs daily at 05:00 UTC
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-profile:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4
        with:
          persist-credentials: true

      # GitHub Summary Cards
      - name: Generate GitHub Summary Cards
        uses: vn7n24fzkq/github-profile-summary-cards@release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          USERNAME: "Abhishek-kumar-vidyarthi"

      # Update LeetCode Card
      - name: Update LeetCode Card
        run: |
          mkdir -p dist
          curl -s -o dist/leetcard.svg "https://leetcard.jacoblin.cool/Abhishek_vidyarthi231?theme=dark&font=Fira+Code&border=1&radius=10&ext=heatmap"

      # Update Activity Graph via public API / image service
      - name: Update Activity Graph Image
        run: |
          curl -s -o dist/activity-graph.svg "https://github-readme-activity-graph.vercel.app/graph?username=Abhishek-kumar-vidyarthi&theme=react-dark&hide_border=true"

      # Update Last Updated in README
      - name: Update Last Updated in README
        run: |
          ts=$(date -u +"%Y-%m-%d %H:%M UTC")
          if grep -q "^Last Updated:" README.md; then
            sed -i "s|^Last Updated:.*|Last Updated: $ts|" README.md
          else
            echo -e "\nLast Updated: $ts" >> README.md
          fi

      # Commit if changed
      - name: Commit Changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          git add dist README.md
          if git diff --staged --quiet; then
            echo "No changes â€” no commit"
          else
            git commit -m "Auto Update Profile (Cards, Graph, LeetCode)"
            git push
          fi
